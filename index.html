<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>First Line Stats</title>
    <!-- Bootstrap core CSS -->
    <link rel='shortcut icon' type='image/x-icon' href="/static/images/favicon.png" />
    <!--{% block page_css %}-->
    <link href="/static/DataTables/datatables.min.css" rel="stylesheet">
    <!--{% endblock %}-->
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <link href="/static/css/fls.css" rel="stylesheet">
  </head>
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <div class="navbar-brand" href="#">
                    <a href="/"><img class="fls-logo" src="/static/images/logo_text.png"></a>
                </div>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Players <span class="caret"></span></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="/players/skaters">Skaters</a></li>
                            <li><a href="/players/goalies">Goalies</a></li>
                        </ul>
                    </li>
                    <li><a href="/teams">Teams</a></li>
                    <li><a href="/games">Games</a></li>
                    <li><a href="/about">About Us</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!--{% block content %}-->
    
    <div class="container">
        <div class="row">
            <div class="col-md-12 table-container">
                <h2>Recent Games</h2>
                <table id="recentgames" class="table table-striped table-hover ">
                    <thead>
                        <tr>
                            <th>Game Date</th>
                            <th>Session</th>
                            <th>Home</th>
                            <th class="text-center">Score</th>
                            <th>Away</th>
                            <th>Corsi</th>
                            <th>Status</th>
                            <th>Start Time</th>
                            <th>End Time</th>
                        </tr>
                    </thead>
                    <tbody>
                    
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="container">
        <h2>Division Standings</h2>
            <div class="row">
                <div class="row">
                  <div class="col-md-12">
                    <h3 class="text-center">Eastern</h3>
                  </div>
                </div>
            <div class="col-md-6">
              <h4 class="text-center">Atlantic</h4>
              <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#currentA" aria-controls="currentA" role="tab" data-toggle="tab">Current</a></li>
                <li role="presentation"><a href="#historicalA" aria-controls="historicalA" role="tab" data-toggle="tab">Historical</a></li>
              </ul>
              <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="currentA">
                  <div class="well bs-component">
                    <table id="atlanticTable" class="table table-striped table-hover ">
                      <thead>
                        <tr>
                          <th>Team Name</th>
                          <th>Games Played</th>
                          <th>Wins</th>
                          <th>Losses</th>
                          <th>Points</th>
                          <th>Goals For</th>
                          <th>Goals Against</th>
                          <th>Streak</th>
                        </tr>
                      </thead>
                      <tbody>
                        
                      </tbody>
                    </table>
                  </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="historicalA">
                  <div id="Ahistorical"></div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <h4 class="text-center">Metropolitan</h4>
              <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#currentM" aria-controls="currentM" role="tab" data-toggle="tab">Current</a></li>
                <li role="presentation"><a href="#historicalM" aria-controls="historicalM" role="tab" data-toggle="tab">Historical</a></li>
              </ul>
              <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="currentM">
                  <div class="well bs-component">
                    <table id="metroTable" class="table table-striped table-hover ">
                      <thead>
                        <tr>
                          <th>Team Name</th>
                          <th>Games Played</th>
                          <th>Wins</th>
                          <th>Losses</th>
                          <th>Points</th>
                          <th>Goals For</th>
                          <th>Goals Against</th>
                          <th>Streak</th>
                        </tr>
                      </thead>
                      <tbody>
                        
                      </tbody>
                    </table>
                  </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="historicalM">
                  <div id="Mhistorical"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="row">
              <div class="col-md-12">
                <h3 class="text-center">Western</h3>
              </div>
            </div>
            <div class="col-md-6">
              <h4 class="text-center">Central</h4>
              <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#currentC" aria-controls="currentC" role="tab" data-toggle="tab">Current</a></li>
                <li role="presentation"><a href="#historicalC" aria-controls="historicalC" role="tab" data-toggle="tab">Historical</a></li>
              </ul>
              <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="currentC">
                  <div class="well bs-component">
                    <table id="centralTable" class="table table-striped table-hover ">
                      <thead>
                        <tr>
                          <th>Team Name</th>
                          <th>Games Played</th>
                          <th>Wins</th>
                          <th>Losses</th>
                          <th>Points</th>
                          <th>Goals For</th>
                          <th>Goals Against</th>
                          <th>Streak</th>
                        </tr>
                      </thead>
                      <tbody>
                        
                      </tbody>
                    </table>
                  </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="historicalC">
                  <div id="Chistorical"></div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <h4 class="text-center">Pacific</h4>
              <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#currentP" aria-controls="currentP" role="tab" data-toggle="tab">Current</a></li>
                <li role="presentation"><a href="#historicalP" aria-controls="historicalP" role="tab" data-toggle="tab">Historical</a></li>
              </ul>
              <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="currentP">
                  <div class="well bs-component">
                    <table id="pacificTable" class="table table-striped table-hover ">
                      <thead>
                        <tr>
                          <th>Team Name</th>
                          <th>Games Played</th>
                          <th>Wins</th>
                          <th>Losses</th>
                          <th>Points</th>
                          <th>Goals For</th>
                          <th>Goals Against</th>
                          <th>Streak</th>
                        </tr>
                      </thead>
                      <tbody>
                        
                      </tbody>
                    </table>
                  </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="historicalP">
                  <div id="Phistorical"></div>
                </div>
              </div>
            </div>
        </div>
    </div>


    <!--{% endblock %}-->
    <script src="/static/js/jquery-2.2.0.min.js"></script>
    <script src="/static/js/bootstrap.js"></script>
    <!--{% block page_js %}-->
    <script src="/static/DataTables/datatables.min.js"></script>
    <script src="/static/js/d3.v3.min.js"></script>
    <script src="/static/js/teamColors.js"></script>
    <script src="/static/js/graphs/historicalStandings.js"></script>
    <script>
        $(document).ready(function() {
            var url = "http://localhost:8080/api/";

            $('#recentgames').DataTable({
                "iDisplayLength": 15,
                "bSort": false,
                "ajax": url + "pbp/recent/?format=json",
                "sAjaxDataProp": "",
                "responsive": true,
                "columns": [
                  {"data": "date",
                   "render": function (data, type, full, meta) {
                      return "<a href=\"/game/?gamePk=" + full.gamePk + "\">" + full.date + "</a>";
                   },
                  },
                  {"data": "gameType"},
                  {
                    "data": "homeTeam",
                    "render": function ( data, type, full, meta ) {
                      return '<img height="17" width="17" src="./static/images/team/' + data.abbreviation + '.png"><a href="/teams"?team=' + data.abbreviation + '">' + data.shortName + '</a>';
                    }
                  },
                  {"data": "score"},
                  {
                    "data": "awayTeam",
                    "render": function ( data, type, full, meta ) {
                      return '<img height="17" width="17" src="./static/images/team/' + data.abbreviation + '.png"><a href="/teams/?team=' + data.abbreviation + '">' + data.shortName + '</a>';
                    }
                  },
                  {"data": "corsi"},
                  {"data": "gameState"},
                  {"data": "dateTime"},
                  {"data": "endDateTime"},
                ]
            });

            var divisions = {"Pacific": [], "Central": [], "Metropolitan": [], "Atlantic": []}
            $.ajax({url: url + "team/stats/?format=json",
                success: function(result) {
                    var atlantic = [],
                        pacific = [],
                        metro = [],
                        central = [];
                    for (var i=0; i<result.length; i++) {
                        var row = result[i],
                            team = '<img height="17" width="17" src="./static/images/team/' + row.team.abbreviation + '.png"><a href="/teams">' + row.team.shortName + '</a>',
                            gp = row.gamesPlayed,
                            wins = row.wins,
                            losses = row.losses,
                            points = row.points,
                            gf = row.goalsScored,
                            ga = row.goalsAgainst,
                            streak = row.streakCode,
                            division = row.team.division,
                            date = row.date,
                            points = row.points;
                        var rowdata = [team, gp, wins, losses, points, gf, ga, streak];
                        divisions[division].push(team);
                        switch (division) {
                            case "Atlantic":
                                atlantic.push(rowdata);
                                break;
                            case "Pacific":
                                pacific.push(rowdata);
                                break;
                            case "Metropolitan":
                                metro.push(rowdata);
                                break;
                            case "Central":
                                central.push(rowdata);
                                break;
                        }
                    }
                    loadTable(atlantic, "#atlanticTable");
                    loadTable(metro, "#metroTable");
                    loadTable(pacific, "#pacificTable");
                    loadTable(central, "#centralTable");
                },
            });
            $.ajax({url: url + "team/dailystats/?format=json",
                success: function(result) {
                    var data = {"Atlantic": {}, "Pacific": {},
                        "Central": {}, "Metropolitan": {},
                    };
                    for (var team in result) {
                        if (result[team]["division"] == "Atlantic")
                            data["Atlantic"][team] = result[team]["history"];
                        else if (result[team]["division"] == "Pacific")
                            data["Pacific"][team] = result[team]["history"];
                        else if (result[team]["division"] == "Metropolitan")
                            data["Metropolitan"][team] = result[team]["history"];
                        else if (result[team]["division"] == "Central")
                            data["Central"][team] = result[team]["history"];
                    }
                    CreateHistorical("#Ahistorical", data["Atlantic"], "#currentA");
                    CreateHistorical("#Mhistorical", data["Metropolitan"], "#currentM");
                    CreateHistorical("#Chistorical", data["Central"], "#currentC");
                    CreateHistorical("#Phistorical", data["Pacific"], "#currentP");
                }
            })

            function loadTable(data, table_id) {
                var tbl_body = "";
                $.each(data, function() {
                    var tbl_row = "";
                    $.each(this, function(k , v) {
                        if (k == 7) {
                            var row_color = "blue";
                            if (v.indexOf("L") != -1)
                                row_color = "red";
                            else if (v.indexOf("W") != -1)
                                row_color = "green";
                            else if (v.indexOf("O") != -1)
                                row_color = "red";
                            tbl_row += "<td style=color:" + row_color + ">" + v + "</td>";
                        } else {
                            tbl_row += "<td>" + v + "</td>";
                        }
                    })
                    tbl_body += "<tr>"+tbl_row+"</tr>";
                })
                $(table_id + " tbody").html(tbl_body);
            }

            /*var data = {{ divisions|safe }};
            CreateHistorical("#Ahistorical", data["A"], "#currentA");
            CreateHistorical("#Mhistorical", data["M"], "#currentM");
            CreateHistorical("#Chistorical", data["C"], "#currentC");
            CreateHistorical("#Phistorical", data["P"], "#currentP");*/
        });
    </script>
    <!--{% endblock %}-->
  </body>
</html>
    